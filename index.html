<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script src="../Cesium.js"></script>
    <style>
        @import url(../Widgets/widgets.css);
        html, body, #cesiumContainer {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
        }
    </style>
    <div id="cesiumContainer"></div>
    <script>
		Cesium.Ion.defaultAccessToken ='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3OGNjOGU5Ni00NzUyLTQ2MzYtYjNiMi1hNWU0NTcwOTZjMGEiLCJpZCI6MTg4ODI2LCJpYXQiOjE3MDQ4NDk3NTN9.jy2esjOUJ4h-BTxDFfVxv_i4UJlTAu9s2i_2j_hO_Hc';
        var viewer = new Cesium.Viewer('cesiumContainer',{
            animation:false, //动画控制，默认true
            baseLayerPicker:true,//地图切换控件(底图以及地形图)是否显示,默认显示true
            fullscreenButton:false,//全屏按钮,默认显示true
            geocoder:false,//地名查找,默认true
            timeline:false,//时间线,默认true
            vrButton:false,//双屏模式,默认不显示false
            homeButton:true,//主页按钮，默认true
            selectionIndicator:false,//选中元素显示,默认true
            navigationHelpButton:false,//导航帮助说明,默认true
            navigationInstructionsInitiallyVisible:false,
            automaticallyTrackDataSourceClocks:false,//自动追踪最近添加的数据源的时钟设置,默认true
            sceneModePicker : true,//是否显示地图2D2.5D3D模式
            sceneMode: 3,//指定地图影像显示2D
        });

        viewer.camera.flyTo({
            // fromDegrees()方法，将经纬度和高程转换为世界坐标
            destination:Cesium.Cartesian3.fromDegrees(120.62,31.30,600000.0)
        });
        let geojsonUrl = "geo.geojson"

        // viewer.dataSources.add(
        //     Cesium.GeoJsonDataSource.load(geojsonUrl)    
        // )

        fetch(geojsonUrl)
            .then(response => response.json())
            .then((data) => {
                var entities = [];
                data.features.forEach(function (feature) {
                    var entity = featureToEntity(viewer, feature);
                    if (entity !== undefined && entity !== null) {
                        entities.push(entity);
                    }
                });
                // 添加所有Entities到场景中显示
                viewer.entities.add(entities);
        })

        // 将GeoJSON Feature转换为Cesium Entity
        function featureToEntity(viewer, feature) {
            var geometryType = feature.geometry.type;
            return pointToEntity(viewer, feature);
        }
        // Point类型的Geometry转换为Cesium Entity
        function pointToEntity(viewer, feature) {
            var position = Cesium.Cartesian3.fromDegrees(feature.geometry.coordinates[0], feature.geometry.coordinates[1]);
            var properties = feature.properties || {};
            let color = null
            if(properties.date === "清及以前"){
                color = Cesium.Color.PALETURQUOISE
            }else if(properties.date === "1900-1999"){
                color = Cesium.Color.NAVAJOWHITE
            }else{
                color = Cesium.Color.RED
            }
            var entity = viewer.entities.add({
                name : properties.name,
                description: "类别: " + properties.grade + "</br></br>" + 
                    "建筑年代: " + properties.date + "</br></br>" +  
                    "地址: " + properties.address + "</br></br>" + 
                    "公布时间: " + properties.year + "年",
                position : position,
                point : {
                    pixelSize : 8,
                    color : color
                }
            });
            return entity;
        }
    </script>
</body>
</html>